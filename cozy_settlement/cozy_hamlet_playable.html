<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cozy Hamlet ‚Äî Playable Build</title>
<style>
  :root{
    --bg:#10141f; --panel:#161b2a; --panel2:#1a2133; --ink:#eef3ff; --muted:#bfc9ff;
    --accent:#93dda4; --warn:#ffd27a; --bad:#ff9b9b; --line:#2b3557;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Arial; color:var(--ink);
       background: radial-gradient(1000px 500px at 60% -10%, rgba(255,255,255,.06), transparent 60%), linear-gradient(180deg,#0c1020,#0f1430);}
  .wrap{display:grid; grid-template-rows:auto 1fr auto; height:100%}
  header,footer{padding:10px 12px; background:linear-gradient(180deg,var(--panel),var(--panel2)); border-top:1px solid var(--line); border-bottom:1px solid var(--line)}
  .row{display:flex; align-items:center; gap:8px; flex-wrap:wrap}
  .pill{background:#0d1325;border:1px solid var(--line); padding:6px 10px; border-radius:999px; font-weight:700}
  .grid{display:grid; grid-template-columns: 320px 1fr 320px; gap:10px; padding:10px}
  .panel{background:linear-gradient(180deg,var(--panel),var(--panel2)); border:1px solid var(--line); border-radius:12px; padding:10px; overflow:auto}
  h2{margin:4px 0 8px; font-size:18px}
  .btn{background:#232c4d; border:1px solid var(--line); color:var(--ink); padding:8px 10px; border-radius:10px; font-weight:800; cursor:pointer}
  .btn:hover{filter:brightness(1.08)}
  .btn[disabled]{opacity:.5; cursor:not-allowed}
  .small{font-size:12px; color:var(--muted)}
  .bcard{border:1px solid var(--line); border-radius:10px; background:#0f1430; padding:8px; margin-bottom:6px}
  .flex{display:flex; justify-content:space-between; align-items:center; gap:6px}
  .cost{font-size:12px; color:#cbd4ff}
  .village{position:relative; aspect-ratio:16/9; background:linear-gradient(180deg,#132049,#0f1638); border:1px solid var(--line); border-radius:12px; overflow:hidden}
  .ground{position:absolute; inset:8px; display:grid; grid-template-columns: repeat(10,1fr); grid-auto-rows:1fr; gap:6px}
  .tile{border:1px solid #34406d; background:linear-gradient(180deg,#17264b,#15213f); border-radius:8px; position:relative; display:flex; align-items:center; justify-content:center; font-size:18px}
  .label{position:absolute; bottom:4px; right:6px; font-size:10px; color:#d6e0ff; opacity:.85}
  .log{white-space:pre-wrap; font-size:12px}
  .toast{position:fixed; right:12px; bottom:12px; background:#0f1430; border:1px solid var(--line); border-radius:10px; padding:10px 12px; display:none}
</style>
</head>
<body>
<header>
  <div id="resRow" class="row"></div>
  <div class="row" style="gap:16px; margin-top:6px">
    <span class="pill">Tier <b id="tier">Hamlet I</b></span>
    <span class="pill">Day <b id="day">1</b></span>
    <span class="pill">Season <b id="season">Spring</b></span>
    <span class="pill">Time <b id="clock">06:00</b></span>
    <span class="pill">Happiness <b id="happy">100%</b></span>
    <span class="small" style="opacity:.9">Tip: Press <b>G</b> to quick-gather.</span>
  </div>
</header>

<div class="grid">
  <aside class="panel">
    <h2>Actions</h2>
    <div class="row" style="gap:10px; flex-wrap:wrap">
      <button id="gWood" class="btn">üå≤ Forage Wood<br><span class="small">+5 wood ¬∑ 3s</span></button>
      <button id="gFood" class="btn">üçì Forage Berries<br><span class="small">+5 food ¬∑ 3s</span></button>
      <button id="gStone" class="btn">ü™® Scavenge Stone<br><span class="small">+3 stone ¬∑ 5s</span></button>
    </div>
    <h2 style="margin-top:10px">Build</h2>
    <div id="buildList"></div>
  </aside>

  <main class="panel">
    <div class="village">
      <div id="ground" class="ground"></div>
    </div>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px">
      <section class="bcard">
        <div class="small"><b>Upgrades</b> ‚Äî simple boosts unlocked by tier</div>
        <div id="upgrades"></div>
      </section>
      <section class="bcard">
        <div class="small"><b>Milestones</b> ‚Äî goals that grant rewards</div>
        <div id="quests"></div>
      </section>
    </div>
  </main>

  <aside class="panel">
    <h2>Town Journal</h2>
    <div id="log" class="log"></div>
    <h2>Settings</h2>
    <button id="reset" class="btn" title="Start fresh">Reset Game</button>
  </aside>
</div>

<footer>
  <div class="small">Cozy Hamlet ‚Äî playable build. No placeholders. Everything works offline in one file.</div>
</footer>

<div id="toast" class="toast"></div>

<script>
// ==== helpers
const $ = s=>document.querySelector(s); const $$=s=>Array.from(document.querySelectorAll(s));
const fmt=n=>n>=1e6?(n/1e6).toFixed(1)+'M':n>=1e3?(n/1e3).toFixed(1)+'k':Math.floor(n);
const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
function toast(msg){ const t=$('#toast'); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',1500); }
function log(msg){ const el=$('#log'); const time=new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}); el.textContent='['+time+'] '+msg+'\\n'+el.textContent; }

// ==== data
const RES = ["wood","stone","food","gold","housing","pop","faith","knowledge","culture"];
const EM = {wood:"üå≤",stone:"ü™®",food:"üçû",gold:"ü™ô",housing:"üè†",pop:"üë™",faith:"‚õ™",knowledge:"üìú",culture:"üé∂"};
const SEASONS=[{name:"Spring", farm:1.1},{name:"Summer", farm:1.25},{name:"Autumn", farm:1.0},{name:"Winter", farm:0.6}];
const BUILDINGS=[
  {key:"wood", name:"Woodcutter Hut", icon:"ü™ì", desc:"Produces wood.", cost:{wood:10}, prod:{wood:1}},
  {key:"farm", name:"Wheat Farm", icon:"üåæ", desc:"Produces food (seasonal).", cost:{wood:15}, prod:{food:1}},
  {key:"cott", name:"Cottage", icon:"üèöÔ∏è", desc:"Provides housing for +3 villagers.", cost:{wood:25,stone:8}, house:3},
  {key:"bakery",name:"Bakery",icon:"ü•ê", desc:"Converts food to gold.", cost:{wood:40,stone:25}, prod:{gold:0.5}, use:{food:0.8}, tier:1},
  {key:"inn", name:"Inn", icon:"üçª", desc:"Raises happiness slowly.", cost:{wood:60,stone:40,gold:30}, mood:+0.4, tier:1},
  {key:"chapel", name:"Chapel", icon:"‚õ™", desc:"Generates faith.", cost:{wood:100,stone:100,gold:80}, prod:{faith:0.3}, tier:2},
  {key:"library", name:"Library", icon:"üìö", desc:"Generates knowledge.", cost:{wood:120,stone:120,gold:120}, prod:{knowledge:0.35}, tier:2},
];
const TIERS=[
  {name:"Hamlet I", need:{}},
  {name:"Village II", need:{pop:10, food:120}},
  {name:"Market Town III", need:{pop:20, gold:180}},
];

// ==== state
const S = {
  res:{wood:20, stone:8, food:15, gold:0, housing:0, pop:3, faith:0, knowledge:0, culture:0},
  b:{}, tier:0, day:1, secs:6*60, season:0, happy:100,
};
BUILDINGS.forEach(b=>S.b[b.key]=0);

// ==== UI
function drawRes(){
  const row=$('#resRow'); row.innerHTML='';
  RES.forEach(k=>{
    const pill=document.createElement('span'); pill.className='pill';
    pill.innerHTML = `${EM[k]} <b id="r_${k}">${fmt(S.res[k]||0)}</b> <span class="small" style="margin-left:4px">${k}</span>`;
    row.appendChild(pill);
  });
}
function drawBuild(){
  const list=$('#buildList'); list.innerHTML='';
  BUILDINGS.forEach(b=>{
    if((b.tier||0) > S.tier) return;
    const card=document.createElement('div'); card.className='bcard';
    card.innerHTML=`<div class="flex">
      <div><strong>${b.icon} ${b.name}</strong><div class="small">${b.desc}</div></div>
      <div><b id="cnt_${b.key}">${S.b[b.key]}</b></div></div>
      <div class="cost">Cost: ${Object.entries(b.cost).map(([k,v])=>`${EM[k]} ${Math.floor(v)}`).join(' ¬∑ ')}</div>
      <div class="flex"><button id="buy_${b.key}" class="btn">Build</button></div>`;
    list.appendChild(card);
    $('#buy_'+b.key).onclick=()=>tryBuild(b);
  });
}
function drawGrid(){
  const g=$('#ground'); g.innerHTML='';
  const W=10,H=6;
  for(let i=0;i<W*H;i++){
    const t=document.createElement('div'); t.className='tile'; t.dataset.idx=i;
    t.innerHTML='<span class="label"></span>';
    g.appendChild(t);
  }
  // place built
  BUILDINGS.forEach(b=>{
    for(let i=0;i<S.b[b.key];i++) placeTile(b);
  });
}
function placeTile(b){
  const t = $$('.tile').find(t=>!t.dataset.b);
  if(!t) return;
  t.dataset.b=b.key;
  t.innerHTML=`<div>${b.icon}</div><div class="label">${b.name.split(' ')[0]}</div>`;
}
function drawMeta(){
  $('#tier').textContent=TIERS[S.tier].name; $('#day').textContent=S.day;
  $('#season').textContent=SEASONS[S.season].name;
  const h=Math.floor(S.secs/60)%24, m=Math.floor(S.secs%60);
  $('#clock').textContent = String(h).padStart(2,'0')+':'+String(m).padStart(2,'0');
  $('#happy').textContent=Math.round(S.happy)+'%';
}
function refresh(){
  RES.forEach(k=>$('#r_'+k).textContent=fmt(S.res[k]||0));
  BUILDINGS.forEach(b=>{ const x=$('#cnt_'+b.key); if(x) x.textContent=S.b[b.key]; });
  drawMeta();
  // Enable/disable build buttons
  BUILDINGS.forEach(b=>{
    const btn=$('#buy_'+b.key); if(!btn) return;
    const ok=Object.entries(b.cost).every(([k,v])=>(S.res[k]||0)>=v);
    btn.disabled=!ok;
  });
}

// ==== game logic
function gain(o){ Object.entries(o).forEach(([k,v])=>S.res[k]=(S.res[k]||0)+v); refresh(); }
function tryBuild(b){
  const ok=Object.entries(b.cost).every(([k,v])=>(S.res[k]||0)>=v);
  if(!ok) return toast("Not enough resources.");
  Object.entries(b.cost).forEach(([k,v])=>S.res[k]-=v);
  S.b[b.key]++; placeTile(b); log("Built "+b.name+".");
  // housing handled separately
  if(b.house){ S.res.housing += b.house; }
  refresh();
}
function produce(dt){
  // buildings
  BUILDINGS.forEach(b=>{
    const n=S.b[b.key]; if(!n) return;
    if(b.prod){
      for(const k in b.prod){
        let v=b.prod[k]*n;
        if(b.key==='farm' && k==='food') v*=SEASONS[S.season].farm;
        S.res[k]+=v*dt;
      }
    }
    if(b.use && b.use.food){
      const need=b.use.food*n*dt;
      const use=Math.min(S.res.food, need); S.res.food-=use;
      if(b.prod && b.prod.gold){ S.res.gold += (b.prod.gold*n)*(use/need || 0)*dt; }
    }
    if(b.mood){ S.happy += b.mood*dt; }
  });
  // pop & hunger
  const spare=(S.res.housing||0)-(S.res.pop||0);
  if(spare>0 && S.res.food>20){ S.res.pop = Math.min(S.res.pop + 0.02*dt, S.res.housing); }
  S.happy = clamp(S.happy + (S.res.food>5? 0.05*dt : -0.2*dt), 50, 130);
  // happiness affects outputs lightly
  const happyK = 0.9 + (S.happy-100)/200;
  ['wood','stone','food','gold','faith','knowledge','culture'].forEach(k=> S.res[k]*=1 );
  // time & season
  S.secs += dt*60; // faster clock: 1s real = 60s game
  if(S.secs>=24*60){ S.secs-=24*60; S.day++; if((S.day-1)%6===0){ S.season=(S.season+1)%SEASONS.length; log("Season is now "+SEASONS[S.season].name+"."); } }
}
function loop(){
  produce(0.2); // dt seconds
  refresh();
  requestAnimationFrame(loop);
}

// ==== interactions
function cooldown(btn,ms){
  btn.disabled=true;
  const base=btn.innerHTML;
  let t=ms/1000;
  const id=setInterval(()=>{
    t--; btn.innerHTML = base.replace(/<br>.*/,'')+`<br><span class="small">${t}s</span>`;
    if(t<=0){ clearInterval(id); btn.innerHTML=base; btn.disabled=false; }
  },1000);
}
$('#gWood').onclick=e=>{ gain({wood:5}); cooldown(e.currentTarget,3000); log("Gathered fallen branches."); };
$('#gFood').onclick=e=>{ gain({food:5}); cooldown(e.currentTarget,3000); log("Picked wild berries."); };
$('#gStone').onclick=e=>{ gain({stone:3}); cooldown(e.currentTarget,5000); log("Salvaged useful stones."); };
window.addEventListener('keydown',e=>{ if(e.key.toLowerCase()==='g') $('#gWood').click(); });
$('#reset').onclick=()=>{ if(confirm("Reset game?")) location.reload(); };

// ==== bootstrap
drawRes(); drawBuild(); drawGrid(); drawMeta(); refresh(); log("A cozy hamlet begins by the creek.");
loop();
</script>
</body>
</html>
